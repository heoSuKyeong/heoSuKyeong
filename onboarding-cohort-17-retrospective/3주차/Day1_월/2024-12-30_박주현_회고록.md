# Daily Retrospective

**작성자**: [박주현]  
**작성일시**: [2024-12-30]

# 1. 오늘 배운 내용

## 1️⃣ zeus05ba 도메인과 ECOUNT 서버 구조

환경 설치를 하면서 테스트 서버인 zeus05ba 환경과 서버에 대해서 배웠습니다.
zeus05ba 는 이카운트 개발자들이 개발을 하고 테스트를 해볼 수 있는 환경입니다.
zeus05ba 는 3가지 서버로 구성이 되어 있고 각각 하나의 DB 를 바라보고 있습니다.
아래에 간단하게 서버 구조를 도식화 해보았습니다.

<img src="../ref/박주현 2024-12-30 회고록 이미지1.jpg"/>

성준 책임님께 하나의 클라우드 서버에 포트별로 애플리케이션이 분리가 되어서 3개의 애플리케이션이 구동되는 것인지 여쭤봤는데, 그렇지 않고 각각의 애플리케이션이 각각의 서버에 존재한다고 말씀해주셨습니다. AWS EC2 또는 엘라스틱빈스톡에서 하나의 애플리케이션이 작동을 하고 그 앞에 로드밸런서가 트래픽을 분산해주는 형태를 갖고 있습니다.

이런 형태는 E존에 있는 80000번에서도 동일했습니다. 아마 테스트 환경을 운영환경과 똑같이하기 위해서 테스트 서버도 동일하게 구성되어 있다고 추측하였습니다.

이런 구조를 갖게된 것은 비즈니스 차원 관점에서 바라봐야합니다. DB의 운영비용이 더 높고, 애플리케이션을 구동시킬 클라우드 서버 비용이 낮아, 하나의 DB서버와 3개의 백엔드 서버를 갖는 구조를 채택하였다고 배웠습니다.

트래픽을 1,2,3 서버에 분산해주는 역할은 로드밸런서가 담당합니다. 이카운트의 서버 존인 E존으로 예시를 들겠습니다.
로드밸런서의 플랫폼이 AWS ALB 인지 NGINX 인지 모르겠지만, 큰 개념에서 동작 구조는 같으므로 단어를 순화해서 표현하겠습니다.

사용자가 REQUEST 를 보내면 바로 백엔드 서버에 요청이 가는 것이 아니라, 프록시인 로드밸런서에 가게됩니다.

```
https://logine.ecount.com
```

로드밸런서엔 리스너 설정(서버 네임 설정 등등) logine 엔 upstream 으로 logine1, logine2, logine3 이 묶여져있습니다.
따라서 logine 로 요청을 보내면 logine1,2,3 으로 트래픽이 나뉘어져 요청처리를 하게 됩니다.

```
https://logine1.ecount.com,
https://logine2.ecount.com,
https://logine3.ecount.com

```

위 URL 처럼 각각의 서버 번호로 요청을 보내도 정상적으로 작동을 합니다. DNS 설정을 할 수 있는 Route 53 에서 logine1,2,3 각각에 대한 dname 레코드가 설정이 되어 있고, logine 은 로드밸런서로 포워딩되도록 레코드 설정이 되어 있음을 추측해볼 수 있습니다.

클라우드 서버 구조 관점에서 logine1,2,3 서버는 각각 독립된 클라우드 서버에서 구동되고 있습니다. 하나의 클라우드에서 서버 포트 번호만 8081,8082,8083 으로 작동할 수 있지만, 그렇지 않은 구조입니다.

이런 구조를 갖는다면 다음과 같은 이점을 가질 수 있습니다.

1. 각각의 분리된 클라우드 서버 환경을 갖기 때문에, 한 곳에서 오류와 에러를 통해 문제가 발생하더라도 다른 서버에 영향이 없습니다.
2. 각각의 독립된 리소스를 사용하기에 성능과 이슈 문제가 없습니다.

이런 장점이 있기에 따라오는 단점도 있습니다.

1. 클라우드 서버를 개별로 사용하기에 관리해야하는 클라우드 서버의 갯수가 늘어납니다. 이는 Observability 신경 쓸 때 각각의 서버에서 로깅, 메트릭을 측정해야하기에 관리가 힘듭니다.
2. 독립된 서버를 갖기에 하나하나 인스턴스가 모두 비용입니다.

성능을 위해 분산 시스템을 사용하기에 각각 분리된 클라우드 서버를 갖게됩니다.

세션 스토리지
logine1,2,3 으로 서버를 바꿔가며 요청을 보내도 다시 로그인을 하라는 로그인창이 나타나지 않습니다.
이는 세션관리가 중앙집권적으로 일어나기 때문입니다.

1,2,3 분산된 서버에 하나의 세션 스토리지를 사용하기 때문입니다. 만약 각각의 서버마다 세션 스토지리를 다르게 사용한다면 다른 서버로 트래픽이 갈때마다 새로 로그인 해줘야할 것입니다.

```
e.g.
1. logine1 서버에 박주현 로그인 처리를 하고 요청을 보냄.
2. logine1 에 할당된 세션 스토리지엔 박주현이 등록됨.
3. 요청을 보냈는데, 로드밸런서에 의해 logine2로 요청이 처리 됐는데, 인증처리가 안되어 있기에 로그인 창으로 리다이렉트 보내짐.
```

따라서 분산 시스템에선 중앙에서 모두 등록하고 말소할 수 있는 세션 스토리지를 가져야합니다.
이카운트의 세션 저장 방식이 JWT를 사용한 방식인지, 세션 스토리지에 정보를 저장하는 방식인지는 아직 파악하지 못했습니다. JWT를 활용한다면 유저의 정보가 인코딩되어 브라우저에 쿠키에 담겨져 오므로 REST 의 무상태성을 지킬 수 있지만, 중앙에서 유저의 세션을 관리를 하지 못합니다. 세션 스토리지에 저장의 경우 유저의 정보를 서버에 저장하므로 무상태성을 지키진 못하지만, 서버측에서 사용자 세션관리를 할 수 있게 됩니다.

AWS 를 활용한다면 관계형 DBMS 서비스인 RDS 를 활용할텐데, A~E 존까지 하나의 RDS를 활용하는지, 성능적 이슈를 어떻게 해결하는지 궁금했습니다.
Master-Replica 아키텍쳐를 활용하는지, 아니면 하나의 RDS만을 두고, 다운시 서브 RDS를 활성해 하여 사용하는 활성-비활성 클러스터링을 활용하는지 궁금했습니다.

---

# 2. 동기에게 도움 받은 내용

성철님, 현철님, 아연님, 연아님께 도서구입 결재서 올리는 법을 배웠습니다. 승준님께 concat() 함수 사용과 문자열 + 연산자 사용 차이에 대한 이슈에 대해서 공유 받아 학습했습니다. 해당 문제가 일어나는 상황과 컴파일에러 그리고 팀장님께 공유 받은 원인을 함께 공유해주셨습니다.
짝궁인 건호님과 상의해가며 환경셋팅을 진행하였습니다.

---

# 3. 개발 기술적으로 성장한 점

## 3-1. 교육 과정 상 배운 내용이 아닌 개인적 호기심을 해결하기 위해 추가 공부한 내용

앞으로 저희가 구현해야할 내용은 외화 등록 CRUD 입니다.
오늘은 셋팅 이슈로 피들러 다운만을 하였습니다. 그래서 피들러를 활요하여 검색시 일어나는 요청과 응답을 해체분석하였습니다.
<img src="../ref/박주현 2024-12-30 회고록 이미지5.png"/>

외화 리스트에서 검색을 하게 되면 다음과 같은 API 호출이 일어나게 됩니다.

<img src="../ref/박주현 2024-12-30 회고록 이미지2.png"/>

조회 요청이지만 POST 메소드를 활용한 것을 볼 수 있습니다. 이유는 요청을 보내야할 쿼리 파람이 너무 많아서 POST 를 활용해 REQUEST BODY 에 보내기 위함입니다.(제 추측)
아래 블럭에 요청에 대한 응답 바디내용을 볼 수 있습니다.

### 빠른 검색과 상세 검색의 차이

일반적으로 이카운트 ERP 기능에선 엔터를 쳐서 바로 검색하는 빠른 검색과 파랑색 Search 버튼을 눌러서 검색하는 상세 검색이 있습니다.
이 두 기능에 대한 차이를 피들러를 통해 살펴보았습니다.

#### 1. 빠른 검색

<img src="../ref/박주현 2024-12-30 회고록 이미지6.png"/>

<img src="../ref/박주현 2024-12-30 회고록 이미지4.png"/>

빠른 검색에 2를 검색하면 환율코드뿐 아니라 환율명에 2가 들어간 모든 값을 검색해 오게 됩니다.

#### 2. 상세 검색

<img src="../ref/박주현 2024-12-30 회고록 이미지7.png"/>

<img src="../ref/박주현 2024-12-30 회고록 이미지8.png"/>

<img src="../ref/박주현 2024-12-30 회고록 이미지3.png"/>

상세 검색에 환율 코드에 2를 검색하면 환율 코드에 2가 들어간 값들이 나오게 됩니다.

이때 리퀘스트 바디를 보면 차이가 있습니다. 두 가지 기능은 같은 API 를 사용하는 걸 볼 수 있습니다. 하지만 쿼리 파라미터에 차이를 두어 사용합니다.

빠른 검색엔 PARAM 프로퍼티에 값을 받아 관련된 모든 값을 조회하지만, 환율 코드를 이용한 상세 검색은 CODE_NO 를 통해 조회가 일어납니다.

필요없는 필드에는 NULL 이 들어가서 빈값으로 유지하고 필요한 필드에는 값을 넣어 요청 DTO 를 재활용하고 요청 API 를 재활용함을 볼 수 있습니다.

이런 방식에 대해 의문점이 생겼습니다.

```
1. 두 기능에 따라 API 분리를 하면 소스 코드는 늘어나더라도 기능적으로 더 명료하고 깔끔해지지 않았을까?

처음엔 왜 나누지 않았을까를 고민했지만, 하나의 API 를 재활용하는 측면을 더 고려한 것이라 결론지었습니다.
```

```
2. NULL 이 들어가는 필드는 왜 생략하지 않았을까?

값이 없는 필드들을 생략하여 REQUEST 를 보내면 REQUEST 메시지 양이 줄어들기 때문에 인터넷 대역폭을 적게 잡아먹고 성능 향상을 기대해 볼 수 있습니다.
하지만 값이 없는 필드들까지 빈값으로 메시지에 보내는 걸 확인 할 수 있습니다.
클라이언트에서 null 값을 넣어서 보내면 자바-스프링 프레임워크에서도 objectMapper 를 통해 값이 없는 필드는 누락을 시켜 다룰 수 있습니다.
클라이언트의 요청에서 null 보내면 REQUEST 메시지에서 누락되지만, 피들러를 통해 그냥 보이는 건지, 아니면 실제로 누락을 안시키고 요청 메시지를 보내는 것인지 궁금증이 생겼습니다.
필드를 누락시켜서 보내는 게 아니라면, 왜 이런 방법을 채택했는지 궁금했습니다.

```

---

# 4. 소프트 스킬면에서 성장한 점

오늘은 5.0 환경 셋팅을 하면서 단체 메신저에서 동기들과 많은 이야기를 나눴습니다. 사내 QoS 정책에 따라 깃 클론이 늦어지며, 서로의 상황을 공유하고 농담을 나눴습니다. 전엔 많이 딱딱한 메신저였는데, 동기들이 친해지면서 장난도 많이하고 메신저에서도 서로 말을 잘하게 된 모습이 매우 보기 좋고 뿌듯합니다.

성준 책임님께서 5.0 셋팅 도중 질문을 하셨는데, 질문에 대한 답변이 없으면 강연자가 얼마나 민망할지 알기에 바로바로 대답을 하였습니다. 다른 곳의 분위기는 모르겠지만 저희 기수는 건호님, 성재님 등등 답변을 잘하는 분위기라 좋습니다.

---

# 5. 제안하고 싶은 내용

성준 책임님의 목소리 부드럽고 따듯한 목소리로 진행해주셔서 매우 좋았습니다.
제안할 내용은 신입 개발자 PC 세팅 가이드 전표를 보면 타 블로그를 참고하거나, 가이드의 일정부분 빈부분이 있었는데, 자체적으로 깔끔하게 만들면 다음 기수에 도움이 될 거 같습니다.
한 번 만들어 두면 수정만 조금씩하면 될 거라 예상이 됩니다.
