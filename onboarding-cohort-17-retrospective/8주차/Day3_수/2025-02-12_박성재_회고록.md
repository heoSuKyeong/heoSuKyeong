# Daily Retrospective

**작성자**: [박성재]  
**작성일시**: [2025-02-12]

## 1. 오늘 배운 내용 (필수)

- Search 로직 흐름 정리
- 수정 조회 트러블 슈팅
- 테이블 여러개 사용할 때의 AlterCheckColumnRule

<br/>

### Search 로직 흐름 정리

![image](./ref/박성재%20이미지/Search%20로직%20흐름%20초안.png)

팀장님과 회의 때, 다건 조회 기능과 Search 기능을 하나로 통합하는 건을 주제로 얘기가 나왔었습니다. 공통화 방법을 고민하기 위해, Search 로직의 흐름을 정리하였으며, 다건 조회 기능과 어떻게 통합할 수 있을지 고민하였습니다.

재고 업무를 기준으로 조회 화면을 그려내기 위해 다건 조회 API와 Search API를 모두 사용하며, `DB`에서 리스트 데이터를 가져오는 로직은 Search에만 존재하는 것으로 파악되었습니다.

이후 팀장님과 다시 논의 결과, 위처럼 두 API를 분리하는 이유가 있을 것이라고 하셨습니다. Search 로직 자체가 무겁기 때문에, 단순히 Data만 다시불러와서 그리드를 다시그려내는 경우 등의 상황에서 그때마다 Search 로직을 태우는 것은 바람직하지 않다고 저는 그 이유를 이해하였습니다.

<br/>

### 수정 조회 트러블 슈팅

수정조회 기능을 구현하기 위해 Data Api의 Server 로직을 구현하였습니다. 이후 테스트를 해보니 크게 두가지 문제가 존재했습니다.

1. 그려낼 각 데이터 모델 항목들이 빈값으로 가져와진다.
하드코딩한 `setup` 정보에 `data_model_definitions`에 존재하는 `prop`들의 `prop_id`에 접두어가 존재하지만, Data Api를 사용해 정보를 가져오니 해당 접두어가 붙어지지 않는 상태로 가져와졌습니다.

이에 따라, 수정조회를 정상적으로 동작시키려면 데이터모델 내 각 항목마다 해당 접두어를 추가하는 로직을 추가하거나, `setup`에 존재하던 `prop`들의 `prop_id`의 접두어를 빼버려야합니다.
(하지만, 이렇게하면 수정 저장 시 입력값들이 모두 빈값으로 들어감..)

혹은 저장 기능 시, `DataModelUtil`에서 매칭할 때, 사용하는 `prop_id`와 매칭시켜줄 방법을 `setup`에 접두어를 하드코딩하는 방법말고 다른 방법을 찾는 방법이 있었습니다.

마지막 방법이 현재 기준 가장 바람직한(결국 이렇게 동작이 되어야함) 방법으로, 아마 내일 이 문제를 가장 먼저해결할 것 같습니다.

2. 데이터모델을 반환 시 이중 배열로 반환되어진다.
로직을 살펴보니 `Dac`에서 반환값을 배열로 감싸 반환하고 있었습니다. 해당 로직도 수정되어야할 것 같습니다.

<br/>

### 테이블 여러개 사용할 때의 AlterCheckColumnRule

조회 기능 로직에서 `Dac`의 경우 우리는 `Join`을 통해 데이터들을 반환하고 있었습니다. 여기서 `Join`을 위해서는 테이블을 `viewer`로 만들어 `Join`을 걸어줘야 했습니다.

기준 테이블에만 `AlterCheckColumnRule`을 걸어준 상태로 로직을 돌려보니 `AlterCheckColumnRule` 관련 에러가 터졌습니다.

ESql 메뉴얼 및 타 로직을 확인해보니 테이블을 여러개 사용하여 쿼리를 날릴 경우, 각 테이블마다 `AlterCheckColumnRule`을 걸어줘야하는 것으로 상황을 이해했습니다.

확인해보기위해, `Join` 관련된 로직을 모두 빼버리고 테스트해보니 더이상 에러가 발생하지 않았습니다.

이를 통해 테이블을 여러개 사용할 때는 `AlterCheckColumnRule`을 각 테이블마다 걸어줘야한다는 사실을 배울 수 있었습니다.

하지만 아직 `viewer` 기능을 사용하여 가져온 테이블의 정보에 `AlterCheckColumnRule`을 걸어주는 방법을 알지못해 추후 확인해서 추가적으로 테스트해볼 예정입니다.

<br/>

## 2. 동기에게 도움 받은 내용 (필수)

#### 나강민 선임
수정조회 트러블슈팅 때 함께 고민해주셔서 덕분에 힘이 되었습니다.
