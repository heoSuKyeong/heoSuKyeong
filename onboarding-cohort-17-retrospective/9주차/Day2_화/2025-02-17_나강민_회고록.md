# Daily Retrospective

**ì‘ì„±ì**: [ë‚˜ê°•ë¯¼ë¯¼]  
**ì‘ì„±ì¼ì‹œ**: [2025-02-18]

## 1. ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš© (í•„ìˆ˜)

# **Search Programì„ ìœ„í•œ Page Runtime ë° Setup ì²˜ë¦¬ ê°œìš”**  

## **1. ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš© ì •ë¦¬**  

### **ğŸ“Œ í•µì‹¬ ê°œë…: `definition.ts -> ResolverProvider -> Resolver` íë¦„**
- **`definition.ts`**: ë°ì´í„° ëª¨ë¸ê³¼ ì†ì„±ì„ ì •ì˜.
- **`ResolverProvider`**: ì •ì˜ëœ ë°ì´í„° ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì ì ˆí•œ Resolverë¥¼ ì œê³µ.
- **`Resolver`**: ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ê±°ë‚˜ íŠ¹ì • ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ì—­í• .

---

## **2. Page Runtimeì—ì„œ Search ì†ì„± ì„¤ì • ê³¼ì •**  

### **ğŸ”¹ `PageDefinition` - Search ì†ì„± ì„¤ì •**  
`PageDefinition`ì€ í˜ì´ì§€ ë¡œë”© ì‹œ `search`ì— í•„ìš”í•œ **menu ì†ì„±**ì„ ì„¤ì •í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.  

### **ğŸ“Œ ì£¼ìš” ì—­í• **  
1. **ê²€ìƒ‰ì„ ìœ„í•œ `search` ì†ì„± ì„¤ì •**
2. **Setup ë° ViewModel Container(VMC) ì´ˆê¸°í™”**
3. **ì´ë²¤íŠ¸ ë¸Œë¡œì»¤ ì„¤ì •**
4. **Menu Attribute ì¶”ê°€**  
5. **í˜ì´ì§€ ìƒíƒœ ë° ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •**  

### **ğŸ“Œ ì½”ë“œ ë¶„ì„**
```ts
export const PageDefinition: INavigationPolicy = () => (next) => async (request) => {
	performance.mark('PAGE_LOAD_START');

	const setup_provider = request.execution_context?.getFeature<ISetupResolverProvider>(
		ISetupResolverProvider
	) as ISetupResolverProvider;

	const vmc = setup_provider.createViewModelContainer(request.setup as ISetup);

	const event_broker = request.execution_context?.getFeature<IEventBrokerProvider>(IEventBrokerProvider);
	event_broker?.registerVmc(this as any);

	// create AttributeFeature
	const attributeFeatureFactory = GET_APPLICATION_CONFIGURATIONS()
		.getFeatureFactory<attribute.IAttributeFeature>(attribute.IAttributeFeature.toString());

	(request.execution_context as unknown as IConfigurationContext)?.setFeature(
		attribute.IAttributeFeature,
		(attributeFeatureFactory as any)(vmc)
	);

	const { page_state, page_viewmodel } = await setup_provider.resolveSetup(request.setup as ISetup, vmc, {
		page_state: request.pageLoadOptions?.preserve?.page_state,
		page_runtime: request.pageLoadOptions?.preserve?.page_runtime,
	});

	vmc.updateContainerStore(page_state, page_viewmodel);

	// Search Identifier ì„¤ì •
	const [menu_search] = vmc.getSetup()
		.menu.attributes.filter((item: IAttribute) => item.attr_id === 'search') as IAttribute<menu_attrs.search>[];

	if (menu_search) {
		const search_identifier = menu_search?.data?.user_action?.identifier;
		if (search_identifier && $ECV5.Log.identifier_map.has(search_identifier) === false) {
			$ECV5.Log.identifier_map.set(search_identifier, true);
		}
	}

	// ìš”ì²­ì— page state, viewmodel, dm_manager, vmc ì„¤ì •
	request.page_state = page_state;
	request.page_viewmodel = page_viewmodel;
	request.dm_manager = vmc.getDMManager();
	request.vmc = vmc;

	const result = await (next as IMiddlewareExecutor<INavigationRequest, INavigationResult>)(request);
	return result;
};
```
### **ğŸ” ì£¼ìš” ê¸°ëŠ¥**  
- **`setup_provider.resolveSetup()`**  
  - í˜ì´ì§€ ìƒíƒœ(`page_state`)ì™€ í˜ì´ì§€ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •.  
  - `search` ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ ê²€ìƒ‰ ì¡°ê±´ì„ êµ¬ì„±.  
- **`event_broker.registerVmc()`**  
  - ì´ë²¤íŠ¸ ë¸Œë¡œì»¤ë¥¼ í†µí•´ ViewModelContainer(VMC)ë¥¼ ë“±ë¡.  
- **`vmc.getSetup().menu.attributes`**  
  - ê²€ìƒ‰ ì†ì„±(`search`)ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„, ê²€ìƒ‰ identifierë¥¼ ë¡œê¹….  
- **`request.page_state`, `request.page_viewmodel`, `request.dm_manager`, `request.vmc` ì„¤ì •**  
  - **ê²€ìƒ‰ API í˜¸ì¶œì„ ìœ„í•œ í•„ìˆ˜ ë°ì´í„°**ë¥¼ requestì— í¬í•¨.  

---

## **3. `SetupResolverProvider` - ViewModel Container ë° Resolver ì„¤ì •**  

### **ğŸ“Œ ì—­í• **
- **í˜ì´ì§€ ì´ˆê¸°í™”**
- **ë·° ëª¨ë¸ ìƒì„± ë° ê´€ë¦¬**
- **Setup ê´€ë ¨ Resolver ì„¤ì •**
- **ì†ì„±(Attribute) ì¶”ê°€ ë° ì„¤ì •**
- **ë°ì´í„° ëª¨ë¸ê³¼ Prop ì •ë³´ ì²˜ë¦¬**

### **ğŸ“Œ ì½”ë“œ ë¶„ì„**
```ts
export class SetupResolverProvider implements ISetupResolverProvider {
	feature_id = 'ISetupResolverProvider';
	attrResolvers: any = {};

	constructor(public execution_context: IExecutionContext) {}

	getDefaultPageState(): page_state.IPageState {
		return {};
	}

	getDefaultPageViewModel(): IPageViewModel {
		return {
			header: { sect_sid: 'header', sections: [] },
			contents: { sections: [] },
			footer: { sections: [] },
			className: '',
		};
	}

	getDefaultPageRuntime(): IPageRuntime {
		return {};
	}
```
### **ğŸ” ì£¼ìš” ê¸°ëŠ¥**
1. **ê¸°ë³¸ í˜ì´ì§€ ìƒíƒœ, ViewModel, Runtime ë°˜í™˜**  
   - `getDefaultPageState()`: í˜ì´ì§€ ìƒíƒœ ì´ˆê¸°í™”  
   - `getDefaultPageViewModel()`: ê¸°ë³¸ ViewModel ì„¤ì •  
   - `getDefaultPageRuntime()`: ê¸°ë³¸ Runtime ì„¤ì •  

---

### **ğŸ“Œ Setup ë° Menu Attribute ì„¤ì •**
```ts
async getMenuAttrResolverAsync(
	page_state: page_state.IPageState,
	page_viewmodel: IPageViewModel,
	page_runtime: IPageRuntime,
	setup: ISetup,
	resolve_target_menu_attributes?: IAttribute[]
): Promise<page_state.IPageState> {
	const menu = setup.menu;
	const menu_type = this.execution_context.action.menu_type;
	const module_name = this.execution_context.moduleName.split('.')[1];

	if (!menu) {
		return page_state;
	}

	for (const attribute of resolve_target_menu_attributes ?? setup.menu.attributes ?? []) {
		const attrResolver = ((menu_resolver as any)[`${attribute.attr_id}_${menu_type?.toLowerCase()}_resolver`] ??
			(menu_resolver as any)[`${attribute.attr_id}_${menu_type?.toLowerCase()}_${module_name?.toLowerCase()}_resolver`] ??
			(menu_resolver as any)[`${attribute.attr_id}_resolver`]) as IMenuResolver<any>;

		if (!attrResolver) {
			continue;
		}

		attrResolver({
			execution_context: this.execution_context,
			page_state,
			page_viewmodel,
			setup,
			attribute: attribute.data,
			page_runtime,
		});
	}

	return page_state;
}
```
### **ğŸ” ì£¼ìš” ê¸°ëŠ¥**
- `getMenuAttrResolverAsync()`  
  - **ê²€ìƒ‰ ì†ì„±(`search`)ì„ í¬í•¨í•œ Menu Attributeë¥¼ ì ìš©**  
  - menu_resolverë¥¼ í†µí•´ ì†ì„±(`attribute`)ì„ ê¸°ë°˜ìœ¼ë¡œ Resolver ì‹¤í–‰  

---

### **ğŸ“Œ ViewModel Container ìƒì„± ë° Prop Item ì¡°íšŒ**
```ts
createViewModelContainer(setup: ISetup, page_state?: page_state.IPageState, page_viewmodel?: IPageViewModel) {
	return new ViewModelStateContainer(
		this.execution_context,
		GET_APPLICATION_CONTEXT().viewRenderer,
		setup,
		page_state ?? this.getDefaultPageState(),
		page_viewmodel ?? this.getDefaultPageViewModel(),
		GET_APPLICATION_CONTEXT().getAppStateDispatcher()
	);
}

/** prop item ì •ë³´ì¡°íšŒ í•¨ìˆ˜ ìƒì„± */
createGetPropItemInfo(vmc: IViewModelStateContainerWithHook): IGetPropItemInfo {
	const cached_merged_props: Map<IDataModelContainer, IMergedProp[]> = new Map();

	return async function getPropItemInfo(option: {
		dmc_id: string;
		prop_id: string;
		view_type?: EN_VIEW_TYPE;
		datamodel_index?: number;
		platform?: 'web' | 'excel' | 'csv';
	}) {
		const { dmc_id, prop_id, view_type, datamodel_index, platform } = option;
		const dmc = vmc.getDMManager().getDataModelContainer(dmc_id);
		if (!dmc) {
			return null;
		}

		if (!cached_merged_props.has(dmc)) {
			const merged_props = definitionUtil.createMergedProps(dmc.getDefinition()).mergedProps as IMergedProp[];
			cached_merged_props.set(dmc, merged_props);
		}

		const merged_props = cached_merged_props.get(dmc);
		const prop_def = merged_props?.find((prop) => prop.prop_id === prop_id);
		if (!prop_def) {
			return null;
		}

		return {
			display_value: prop_def.prop_id,
		};
	};
}
```
### **ğŸ” ì£¼ìš” ê¸°ëŠ¥**
- `createViewModelContainer()`: `ViewModelStateContainer` ìƒì„±  
- `createGetPropItemInfo()`: ë°ì´í„° ëª¨ë¸ ì†ì„±(`prop_id`) ì •ë³´ ì¡°íšŒ  

---

## **4. ê²°ë¡ **
- **Search ì†ì„±ì„ Page Runtimeì—ì„œ ê´€ë¦¬**  
- **SetupResolverProviderë¥¼ í†µí•´ ì†ì„± ë° ViewModel ì„¤ì •**  
- **Resolverë¥¼ í™œìš©í•´ ê²€ìƒ‰ì„ ìœ„í•œ ë°ì´í„° ëª¨ë¸ ì„¤ì •**  



## 2. ë™ê¸°ì—ê²Œ ë„ì›€ ë°›ì€ ë‚´ìš© (í•„ìˆ˜)

ë¯¼ì¤€ë‹˜ ì €ë‘ ë§¨ë‚  ê°™ì´ ë°¥ ë¨¹ì–´ì£¼ì‹œê³  ë¬¸ì œê°€ ìƒê²¼ì„ ë–„ ê°™ì´ ì˜ê²¬ ë‚˜ëˆ„ë©´ì„œ ë””ë²„ê¹… ê°™ì´ í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
ì˜¤ëŠ˜ë„ ì¼ì ìœ¼ë¡œë„ ì•„ë‹ˆë”ë¼ë„ ì—¬ëŸ¬ë°©ë©´ì—ì„œ ì €í¬ë¥¼ ì±™ê²¨ì£¼ì‹œëŠ” í˜„ì² ë‹˜ê»˜ ê°ì‚¬í•©ë‹ˆë‹¤. 
ë„í˜•ë‹˜ ë¸Œë¼ìš°ì € ìª½ ëª¨ë¥´ëŠ” ë¡œì§ì´ ìˆìœ¼ë©´ í•­ìƒ í•´ê²°í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
ì£¼í˜„ë‹˜ ë•ë¶„ì— ë§ˆìŒì´ í¸í•´ì§‘ë‹ˆë‹¤ í•­ìƒ ê°ì‚¬í•©ë‹ˆë‹¤.



---

## 3. ê°œë°œ ê¸°ìˆ ì ìœ¼ë¡œ ì„±ì¥í•œ ì  (ì„ íƒ)



### 3. ìœ„ ë‘ ì£¼ì œ ì¤‘ ë¯¸ì²˜ í•´ê²° ëª»í•œ ê³¼ì œ. ì•ìœ¼ë¡œ ê³µë¶€í•´ë³¼ ë‚´ìš©.
sort ë¶€ë¶„ì€ ì–´ë””ì„œ ì²˜ë¦¬í•˜ëŠ”ì§€ì— ëŒ€í•´ ë‚´ì¼ ë¯¼ì£¼ì„ ì„ë‹˜ê³¼ ì´ì•¼ê¸° ë‚˜ëˆ  ì„œë²„ ìª½ ë¡œì§ì— ëŒ€í•´ì„œë„ ì´í•´í•´ì•¼í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.


---

## 4. ì†Œí”„íŠ¸ ìŠ¤í‚¬ë©´ì—ì„œ ì„±ì¥í•œ ì  (ì„ íƒ)
ì˜¤ëŠ˜ ëª¨ë“  ë™ê¸°ë¶„ë“¤ì´ í•˜ë‚˜ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ëª¨ë‘ê°€ ëª¨ì—¬ì„œ ë¬¸ì œë¥¼ ì¡ê³  ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©° ìš©ê¸°ë¥¼ ë³µë‹ì•„ì£¼ëŠ” ëª¨ìŠµì—ì„œ ë§ì´ ì„±ì¥í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë˜í•œ í”„ë¡œì íŠ¸ ì§„í–‰ì— ìˆì–´ì„œ ì§„í–‰ê´€ì ì—ì„œ ë§‰íˆëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´ ë„ì›€ì„ ë°›ëŠ” ë°©ë²•ì´ ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì–´ ì„±ì¥í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.




